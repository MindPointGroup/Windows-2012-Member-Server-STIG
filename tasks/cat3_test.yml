- name: "LOW | V-1075 | AUDIT | The shutdown option will not be available from the logon dialog box."
  win_command: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System /v ShutdownWithoutLogon
  register: shutdown_button_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in shutdown_button_audit.stderr and shutdown_button_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1075

- name: "LOW | V-1075 | PATCH | The shutdown option will not be available from the logon dialog box."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System'
      value: ShutdownWithoutLogon
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1075

- name: "LOW | V-1090 | AUDIT | Caching of logon credentials must be limited."
  win_command: reg query \"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\" /v CachedLogonsCount
  register: cached_logons_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in cached_logons_audit.stderr and cached_logons_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1090

- name: "LOW | V-1090 | PATCH | Caching of logon credentials must be limited."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: CachedLogonsCount
      data: 0
  tags:
      - cat3
      - low
      - patch
      - V-1090

- name: "LOW | V-1112 | AUDIT | Outdated or unused accounts must be removed from the system or disabled."
  win_shell: Search-ADAccount -AccountInactive -UsersOnly -TimeSpan 30.00:00:00
  register: outdated_accounts_audit
  check_mode: no
  changed_when: no
  ignore_errors: yes
  tags:
      - cat3
      - low
      - audit
      - V-1112

- name: "LOW | V-1151 | AUDIT | The print driver installation privilege will be restricted to administrators."
  win_command: reg query \"HKLM\System\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers\" /v AddPrinterDrivers
  register: add_printer_driver_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in add_printer_driver_audit.stderr and add_printer_driver_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1151

- name: "LOW | V-1151 | PATCH | The print driver installation privilege will be restricted to administrators."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers'
      value: AddPrinterDrivers
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1151

- name: "LOW | V-1158 | AUDIT | The Recovery Console SET command must be disabled."
  win_command: reg query \"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole\" /v SetCommand
  register: set_command_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in set_command_audit.stderr and set_command_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1158

- name: "LOW | V-1158 | PATCH | The Recovery Console SET command must be disabled."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole'
      value: SetCommand
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1158

- name: "LOW | V-1165 | AUDIT | The computer account password will not be prevented from being reset."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Netlogon\Parameters /v DisablePasswordChange
  register: disable_password_change_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_password_change_audit.stderr and disable_password_change_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1165

- name: "LOW | V-1165 | PATCH | The computer account password will not be prevented from being reset."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters'
      value: DisablePasswordChange
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1165

- name: "LOW | V-1172 | AUDIT | Users will be warned in advance that their passwords will expire."
  win_command: reg query \"HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" /v PasswordExpiryWarning
  register: password_expiry_warning_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in password_expiry_warning_audit.stderr and password_expiry_warning_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1172

- name: "LOW | V-1172 | PATCH | Users will be warned in advance that their passwords will expire."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: PasswordExpiryWarning
      data: 7
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1172

- name: "LOW | V-1173 | AUDIT | The default permissions of Global system objects will be increased."
  win_command: reg query \"HKLM\System\CurrentControlSet\Control\Session Manager\" /v ProtectionMode
  register: protection_mode_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in protection_mode_audit.stderr and protection_mode_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1173

- name: "LOW | V-1173 | PATCH | The default permissions of Global system objects will be increased."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: ProtectionMode
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1173

- name: "LOW | V-1174 | AUDIT | The amount of idle time required before suspending a session must be properly set."
  win_command: reg query HKLM\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters /v autodisconnect
  register: auto_disconnect_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in auto_disconnect_audit.stderr and auto_disconnect_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1174

- name: "LOW | V-1174 | PATCH | The amount of idle time required before suspending a session must be properly set."
  win_regedit:
      key: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters'
      value: autodisconnect
      data: 0x0000000f
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1174

- name: "LOW | V-3373 | AUDIT | The maximum age for machine account passwords will be set to requirements."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Netlogon\Parameters /v MaximumPasswordAge
  register: max_password_age_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in max_password_age_audit.stderr and max_password_age_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-3373

- name: "LOW | V-3373 | PATCH | The maximum age for machine account passwords will be set to requirements."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters'
      value: MaximumPasswordAge
      data: 30
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-3373

- name: "LOW | V-3472 | AUDIT | If the time service is configured, it will use an authorized time server."
  win_command: reg query HKLM\Software\Policies\Microsoft\W32time\Parameters /v Type
  register: time_type_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in time_type_audit.stderr and time_type_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-3472

- name: "LOW | V-3472 | AUDIT | If the time service is configured, it will use an authorized time server."
  win_command: reg query HKLM\Software\Policies\Microsoft\W32time\Parameters /v NTPServer
  register: NTP_server_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in NTP_server_audit.stderr and NTP_server_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-3472

- name: "LOW | V-4110 | AUDIT | The system will be configured to prevent IP source routing."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters /v DisableIPSourceRouting
  register: disable_ip_routing_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_ip_routing_audit.stderr and disable_ip_routing_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4110

- name: "LOW | V-4110 | PATCH | The system will be configured to prevent IP source routing."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters'
      value: DisableIPSourceRouting
      data: 2
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4110

- name: "LOW | V-4112 | AUDIT | The system will be configured to disable the Internet Router Discover Protocol (IRDP)."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters /v PerformRouterDiscovery
  register: disable_IRDP_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_IRDP_audit.stderr and disable_IRDP_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4112

- name: "LOW | V-4112 | PATCH | The system will be configured to disable the Internet Router Discover Protocol (IRDP)."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters'
      value: PerformRouterDiscovery
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4112

- name: "LOW | V-4113 | AUDIT | The system will be configured to limit how often keep-alive packets are sent."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters /v KeepAliveTime
  register: keep_alive_time_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in keep_alive_time_audit.stderr and keep_alive_time_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4113

- name: "LOW | V-4113 | PATCH | The system will be configured to limit how often keep-alive packets are sent."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters'
      value: KeepAliveTime
      data: 300000
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4113

- name: "LOW | V-4116 | AUDIT | The system must be configured to ignore NetBIOS name release requests except from WINS servers."
  win_command: reg query HKLM\SYSTEM\CurrentControlSet\Services\Netbt\Parameters /v NoNameReleaseOnDemand
  register: name_release_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in name_release_audit.stderr and name_release_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4116

- name: "LOW | V-4116 | PATCH | The system must be configured to ignore NetBIOS name release requests except from WINS servers."
  win_regedit:
      key: 'HKLM:\SYSTEM\CurrentControlSet\Services\Netbt\Parameters'
      value: NoNameReleaseOnDemand
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4116

